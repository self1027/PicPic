<%- include ('partials/header.ejs') %>
    <%- include ('partials/navbar.ejs') %>
    
    <div class="container mt-4">
        <div class="card shadow-sm p-4">
            <h2 class="text-center mb-4">Upload de Imagem</h2>
            <form id="uploadForm" action="/upload" method="POST" enctype="multipart/form-data" class="text-center">
                <div class="mb-3">
                    <input type="file" class="form-control" name="image" accept="image/*" onchange="autoUpload(event)">
                </div>
            </form>
            <div class="text-center mt-3">
                <img id="imagePreview" class="img-fluid rounded shadow" style="display:none; max-width: 100%;" />
            </div>
            <div class="text-center mt-3">
                <label for="threshold">Limiar de Binarização (0-255):</label>
                <input type="number" id="threshold" class="form-control w-25 d-inline" min="0" max="255" value="128">
            </div>
            <div class="text-center mt-3">
                <button class="btn btn-success" onclick="binarizarImagem()">Binarizar</button>
            </div>
        </div>
        
        <div class="card shadow-sm p-4 mt-4">
            <h2 class="text-center mb-4">Imagem Processada</h2>
            <div class="text-center">
                <img id="processedImage" class="img-fluid rounded shadow" style="display:none; max-width: 100%;" />
            </div>
        </div>
    </div>
    
    <script>
        function autoUpload(event) {
            const reader = new FileReader();
            reader.onload = function () {
                const output = document.getElementById('imagePreview');
                output.src = reader.result;
                output.style.display = 'block';
            };
            reader.readAsDataURL(event.target.files[0]);

            const form = document.getElementById('uploadForm');
            const formData = new FormData(form);

            fetch('/upload', {
                method: 'POST',
                body: formData
            }).then(response => response.text())
              .then(() => console.log('Imagem enviada automaticamente.'))
              .catch(error => console.error('Erro ao enviar imagem:', error));
        }

        function binarizarImagem() {
            const threshold = document.getElementById('threshold').value;
            fetch(`/binarizar?threshold=${threshold}`)
                .then(response => response.json())
                .then(data => {
                    const processedImage = document.getElementById('processedImage');
                    processedImage.src = data.imageUrl;
                    processedImage.style.display = 'block';
                })
                .catch(error => console.error('Erro ao binarizar imagem:', error));
        }
    </script>
    
<%- include ('partials/footer.ejs') %>
